{"version":3,"sources":["select/select.js"],"names":[],"mappings":"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","file":"select/select.js","sourceRoot":"/source/","sourcesContent":["import {bindable, customAttribute} from 'aurelia-templating';\nimport {BindingEngine} from 'aurelia-binding';\nimport {inject} from 'aurelia-dependency-injection';\nimport {TaskQueue} from 'aurelia-task-queue';\nimport * as LogManager from 'aurelia-logging';\nimport {fireEvent} from '../common/events';\nimport {getBooleanFromAttributeValue} from '../common/attributes';\nimport {DOM} from 'aurelia-pal';\n\n@inject(Element, LogManager, BindingEngine, TaskQueue)\n@customAttribute('md-select')\nexport class MdSelect {\n  @bindable() disabled = false;\n  @bindable() label = '';\n  @bindable() showErrortext = true;\n  _suspendUpdate = false;\n  subscriptions = [];\n  input = null;\n  dropdownMutationObserver = null;\n\n  constructor(element, logManager, bindingEngine, taskQueue) {\n    this.element = element;\n    this.taskQueue = taskQueue;\n    this.handleChangeFromViewModel = this.handleChangeFromViewModel.bind(this);\n    this.handleChangeFromNativeSelect = this.handleChangeFromNativeSelect.bind(this);\n    this.handleBlur = this.handleBlur.bind(this);\n    this.log = LogManager.getLogger('md-select');\n    this.bindingEngine = bindingEngine;\n  }\n\n  attached() {\n    this.taskQueue.queueTask(() => {\n      this.createMaterialSelect(false);\n\n      if (this.label) {\n        let wrapper = $(this.element).parent('.select-wrapper');\n        let div = $('<div class=\"input-field\"></div>');\n        let va = this.element.attributes.getNamedItem('validate');\n        if (va) {\n          div.attr(va.name, va.label);\n        }\n        wrapper.wrap(div);\n        $(`<label>${this.label}</label>`).insertAfter(wrapper);\n      }\n    });\n    this.subscriptions.push(this.bindingEngine.propertyObserver(this.element, 'value').subscribe(this.handleChangeFromViewModel));\n    // this.subscriptions.push(this.bindingEngine.propertyObserver(this.element, 'selectedOptions').subscribe(this.notifyBindingEngine.bind(this)));\n    // $(this.element).material_select(() => {\n    //   this.log.warn('materialize callback', $(this.element).val());\n    //   this.handleChangeFromNativeSelect();\n    // });\n\n    $(this.element).on('change', this.handleChangeFromNativeSelect);\n  }\n\n  detached() {\n    $(this.element).off('change', this.handleChangeFromNativeSelect);\n    this.observeVisibleDropdownContent(false);\n    this.dropdownMutationObserver = null;\n    $(this.element).material_select('destroy');\n    this.subscriptions.forEach(sub => sub.dispose());\n  }\n\n  refresh() {\n    this.taskQueue.queueTask(() => {\n      this.createMaterialSelect(true);\n    });\n  }\n\n  disabledChanged(newValue) {\n    this.toggleControl(newValue);\n  }\n\n  showErrortextChanged() {\n    this.setErrorTextAttribute();\n  }\n\n  setErrorTextAttribute() {\n    let input = this.element.parentElement.querySelector('input.select-dropdown');\n    if (!input) return;\n    this.log.debug('showErrortextChanged: ' + this.showErrortext);\n    input.setAttribute('data-show-errortext', getBooleanFromAttributeValue(this.showErrortext));\n  }\n\n  notifyBindingEngine() {\n    this.log.debug('selectedOptions changed', arguments);\n  }\n\n  handleChangeFromNativeSelect() {\n    if (!this._suspendUpdate) {\n      this.log.debug('handleChangeFromNativeSelect', this.element.value, $(this.element).val());\n      this._suspendUpdate = true;\n      fireEvent(this.element, 'change');\n      this._suspendUpdate = false;\n    }\n  }\n\n  handleChangeFromViewModel(newValue) {\n    this.log.debug('handleChangeFromViewModel', newValue, $(this.element).val());\n    if (!this._suspendUpdate) {\n      this.createMaterialSelect(false);\n    }\n  }\n\n  toggleControl(disable) {\n    let $wrapper = $(this.element).parent('.select-wrapper');\n    if ($wrapper.length > 0) {\n      if (disable) {\n        $('.caret', $wrapper).addClass('disabled');\n        $('input.select-dropdown', $wrapper).attr('disabled', 'disabled');\n        $wrapper.attr('disabled', 'disabled');\n      } else {\n        $('.caret', $wrapper).removeClass('disabled');\n        $('input.select-dropdown', $wrapper).attr('disabled', null);\n        $wrapper.attr('disabled', null);\n        $('.select-dropdown', $wrapper).dropdown({'hover': false, 'closeOnClick': false});\n      }\n    }\n  }\n\n  createMaterialSelect(destroy) {\n    this.observeVisibleDropdownContent(false);\n    if (destroy) {\n      $(this.element).material_select('destroy');\n    }\n    $(this.element).material_select();\n    this.toggleControl(this.disabled);\n    this.observeVisibleDropdownContent(true);\n    this.setErrorTextAttribute();\n  }\n\n  observeVisibleDropdownContent(attach) {\n    if (attach) {\n      if (!this.dropdownMutationObserver) {\n        this.dropdownMutationObserver = DOM.createMutationObserver(mutations => {\n          let isHidden = false;\n          for (let mutation of mutations) {\n            if (window.getComputedStyle(mutation.target).getPropertyValue('display') === 'none') {\n              isHidden = true;\n            }\n          }\n          if (isHidden) {\n            this.dropdownMutationObserver.takeRecords();\n            this.handleBlur();\n          }\n        });\n      }\n      this.dropdownMutationObserver.observe(this.element.parentElement.querySelector('.dropdown-content'), {\n        attributes: true,\n        attributeFilter: ['style']\n      });\n    } else {\n      if (this.dropdownMutationObserver) {\n        this.dropdownMutationObserver.disconnect();\n        this.dropdownMutationObserver.takeRecords();\n      }\n    }\n  }\n\n  //\n  // Firefox sometimes fire blur several times in a row\n  // observable at http://localhost:3000/#/samples/select/\n  // when enable 'Disable Functionality', open that list and\n  // then open 'Basic use' list.\n  // Chrome - ok\n  // IE 11 - ok\n  // Edge ?\n  //\n  _taskqueueRunning = false;\n\n  handleBlur() {\n    if (this._taskqueueRunning) return;\n    this._taskqueueRunning = true;\n    this.taskQueue.queueTask(() => {\n      this.log.debug('fire blur event');\n      fireEvent(this.element, 'blur');\n      this._taskqueueRunning = false;\n    });\n  }\n}\n"]}